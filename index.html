<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Reaction Trainer</title>
    
    <!-- PWA 및 iOS 설정 -->
    <link rel="manifest" href="/Reactiontrainer/manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/Reactiontrainer/icon-192.png">

    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; width: 100%; height: 100%; font-family: sans-serif; }
        
        .screen {
            position: fixed; top: 0; left: 0;
            width: 100vw; height: 100vh;
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            text-align: center;
        }

        #exercise-screen { background-color: #2ecc71; color: white; }
        #stop-screen { background-color: #e74c3c; color: white; display: none; }

        button {
            padding: 15px 30px; font-size: 1.2rem;
            border: none; border-radius: 10px; cursor: pointer;
            background-color: white; color: #333; margin-top: 20px;
        }
    </style>
</head>
<body>

    <!-- 운동 화면 -->
    <div id="exercise-screen" class="screen">
        <h1>운동 진행 중</h1>
        <p>화면 아무 곳이나 터치하면 정지합니다.</p>
    </div>

    <!-- 정지 화면 -->
    <div id="stop-screen" class="screen">
        <h1>정지 화면</h1>
        <p>터치 중복 방지 0.5초 적용됨</p>
        <button id="resume-btn">다시 시작 (Resume)</button>
    </div>

    <script>
        // 1. 서비스 워커 등록
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/Reactiontrainer/sw.js');
        }

        const exerciseScreen = document.getElementById('exercise-screen');
        const stopScreen = document.getElementById('stop-screen');
        const resumeBtn = document.getElementById('resume-btn');

        let isTransitioning = false; // 중복 터치 방지 플래그

        // 화면 전환 함수
        function changeScreen(from, to) {
            if (isTransitioning) return;
            isTransitioning = true;

            from.style.display = 'none';
            to.style.display = 'flex';

            // 0.5초(500ms) 동안 추가 터치 무시
            setTimeout(() => {
                isTransitioning = false;
            }, 500);
        }

        // 운동 화면 터치 시 정지로 이동
        exerciseScreen.addEventListener('touchstart', (e) => {
            e.preventDefault(); 
            changeScreen(exerciseScreen, stopScreen);
        }, { passive: false });

        // 다시 시작 버튼 터치 시 운동으로 이동
        resumeBtn.addEventListener('touchstart', (e) => {
            e.preventDefault();
            e.stopPropagation(); // 버튼 터치가 화면 터치로 전파되는 것 방지
            changeScreen(stopScreen, exerciseScreen);
        }, { passive: false });

        // PC 테스트를 위한 클릭 이벤트 추가
        exerciseScreen.addEventListener('click', () => changeScreen(exerciseScreen, stopScreen));
        resumeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            changeScreen(stopScreen, exerciseScreen);
        });
    </script>
</body>
</html>
